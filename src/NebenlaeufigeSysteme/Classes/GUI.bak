package NebenlaeufigeSysteme.Classes;

import NebenlaeufigeSysteme.Interfaces.EngineInterface;
import NebenlaeufigeSysteme.Interfaces.ObserverInterface;
import NebenlaeufigeSysteme.Interfaces.SensorInterface;

import javax.swing.*;
import java.awt.*;
import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.Callable;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public class Gui extends Sensor implements SensorInterface, EngineInterface {
    // ---------------------------------------- GUI Objects and Params --------------------------------
    JFrame jFrame;
    JSpinner ta1;
    JSpinner ta2;
    JSpinner ta3;
    JSpinner ta4;
    JLabel motorSpeed;
    JLabel steering;

    // ---------------------------------------- SensorInterface Values --------------------------------
    private List<ObserverInterface> observers = new ArrayList<>();

    // ---------------------------------------- Controll params ---------------------------------------
    ExecutorService exS = Executors.newFixedThreadPool(1);
    String sensorID;
    private boolean first_value = true;
    private  int big_abs_count = 0;

    int[] mValuesFL = {0,0,0,0,0,0};
    int[] mValuesFR = {0,0,0,0,0,0};
    int[] mValuesBL = {0,0,0,0,0,0};
    int[] mValuesBR = {0,0,0,0,0,0};
    private List<int[]> valueMatrix = new ArrayList<>();

    public int lastTransmittedValue = 0;

    // -------------------------------------- Constructor Build Gui -----------------------------------
    Gui(){
        super();
        valueMatrix.add(mValuesFL);
        valueMatrix.add(mValuesFR);
        valueMatrix.add(mValuesBL);
        valueMatrix.add(mValuesBR);

        // --------------------------------- left gui side --------------------------------------------


        jFrame = new JFrame();
        jFrame.setTitle("Car Controller");
        jFrame.setSize(900, 540);
        jFrame.setLocationRelativeTo(null);
        jFrame.setDefaultCloseOperation(WindowConstants.DO_NOTHING_ON_CLOSE);

        JPanel main_panel = new JPanel();
        main_panel.setBackground(Color.DARK_GRAY);
        main_panel.setLayout(new GridLayout(1, 2));
        jFrame.add(main_panel);

        JPanel panel1 = new JPanel();
        panel1.setBorder(BorderFactory.createLineBorder(Color.black));
        panel1.setLayout(new GridLayout(5,1));

        JPanel sliderPanel1 = new JPanel();
        sliderPanel1.setLayout(new GridLayout(1,2));
        JLabel l1_fl = new JLabel("Sensor 1 (fl)");
        ta1 = new JSpinner();
        sliderPanel1.add(l1_fl);
        sliderPanel1.add(ta1);
        panel1.add(sliderPanel1);

        JPanel sliderPanel2 = new JPanel();
        sliderPanel2.setLayout(new GridLayout(1,2));
        JLabel l2_fr = new JLabel("Sensor 1 (fr)");
        ta2 = new JSpinner();
        sliderPanel2.add(l2_fr);
        sliderPanel2.add(ta2);
        panel1.add(sliderPanel2);

        JPanel sliderPanel3 = new JPanel();
        sliderPanel3.setLayout(new GridLayout(1,2));
        JLabel l3_bl = new JLabel("Sensor 3 (bl)");
        ta3 = new JSpinner();
        sliderPanel3.add(l3_bl);
        sliderPanel3.add(ta3);
        panel1.add(sliderPanel3);

        JPanel sliderPanel4 = new JPanel();
        sliderPanel4.setLayout(new GridLayout(1,2));
        JLabel l4_br = new JLabel("Sensor 4 (br)");
        ta4 = new JSpinner();
        sliderPanel4.add(l4_br);
        sliderPanel4.add(ta4);
        panel1.add(sliderPanel4);
        System.out.println("all Panels init");

        Button submitButtton = new Button("Submit");
        panel1.add(submitButtton);

        main_panel.add(panel1);


        // ---------------------------------------- right gui side -------------------------------------------
        JPanel panel2 = new JPanel();
        panel2.setBorder(BorderFactory.createLineBorder(Color.black));
        panel2.setLayout(new GridLayout(2, 2));
        JLabel speedLabel = new JLabel("Fahrgeschwindigkeit");
        JLabel steeringLabel = new JLabel("<html><body><p>Motor eingeschlagen</p> <p>(default: 0°)</p></bodŷ></html>");
        motorSpeed = new JLabel("0");
        steering = new JLabel("0");

        panel2.add(speedLabel);
        panel2.add(motorSpeed);

        panel2.add(steeringLabel);
        panel2.add(steering);
        main_panel.add(panel2);
        submitButtton.addActionListener(e -> {
            transmitValues();
        });
        exS.submit((Callable<String>) () ->{
            startGUI();
            return null;
        } );

    }
    public void startGUI(){
        jFrame.pack();
        jFrame.setVisible(true);

    }

    @Override
    public void setID(String id){
        sensorID = id;
    }
    @Override
    public void lenken(int percent) {
        System.out.println("steering adjusted " + percent);
        steering.setText(Integer.toString(percent));
    }

    @Override
    public void fahren(int percent) {

        motorSpeed.setText(Integer.toString(percent));
    }

    @Override
    public void addObserver(ObserverInterface observer) {
        observers.add(observer);
    }

    @Override
    public void notifyObservers(int value) {
        for(ObserverInterface x: observers){
            x.update("fl", (Integer) mValuesFL[4]);
            x.update("fr", (Integer) mValuesFR[4]);
            x.update("bl", (Integer) mValuesBL[4]);
            x.update("br", (Integer) mValuesBR[4]);
        }
    }

    private void transmitValues(){

        mValuesFLNewValue((Integer) ta1.getValue());
        super.faultTolerantMeasurement(mValuesFL);
        mValuesFRNewValue((Integer) ta2.getValue());
        super.faultTolerantMeasurement(mValuesFR);
        mValuesBLNewValue((Integer) ta3.getValue());
        super.faultTolerantMeasurement(mValuesBL);
        mValuesBRNewValue((Integer) ta4.getValue());
        super.faultTolerantMeasurement(mValuesBR);
    }

    private void mValuesFLNewValue(int newValue){
        mValuesFL[3] = mValuesFL[2];
        mValuesFL[2] = mValuesFL[1];
        mValuesFL[1] = mValuesFL[0];
        mValuesFL[0] = newValue;
    }
    private void mValuesFRNewValue(int newValue){
        mValuesFR[3] = mValuesFR[2];
        mValuesFR[2] = mValuesFR[1];
        mValuesFR[1] = mValuesFR[0];
        mValuesFR[0] = newValue;
    }
    private void mValuesBLNewValue(int newValue){
        mValuesBL[3] = mValuesBL[2];
        mValuesBL[2] = mValuesBL[1];
        mValuesBL[1] = mValuesBL[0];
        mValuesBL[0] = newValue;
    }
    private void mValuesBRNewValue(int newValue){
        mValuesBR[3] = mValuesBR[2];
        mValuesBR[2] = mValuesBR[1];
        mValuesBR[1] = mValuesBR[0];
        mValuesBR[0] = newValue;
    }




}
